[build-system]
build-backend = "hatchling.build"
requires = [ "hatchling" ]

[project]
name = "yosoi"
version = "0.1.0"
description = "AI-Powered CSS Selector Discovery - Discover once, scrape forever with BeautifulSoup"
readme = "README.md"
requires-python = ">=3.13"
classifiers = [
  "Development Status :: 4 - Beta",
  "Intended Audience :: Developers",
  "Programming Language :: Python :: 3 :: Only",
  "Programming Language :: Python :: 3.13",
  "Programming Language :: Python :: 3.14",
  "Topic :: Internet :: WWW/HTTP :: Dynamic Content",
  "Topic :: Software Development :: Libraries :: Python Modules",
]

dependencies = [
  "beautifulsoup4>=4.12",
  "brotli>=1.1",
  "logfire>=4.16",
  "pydantic>=2",
  "pydantic-ai>=0.0.16",
  "python-dotenv>=1.2.1",
  "requests>=2.31",
  "rich>=14.2",
]

scripts.yosoi = "yosoi.cli:main"

[dependency-groups]
dev = [
  "commitizen>=3.13",
  "mypy>=1.8",
  "prek>=0.2.25",
  "types-beautifulsoup4>=4.12",
  "types-requests>=2.31",
]
tests = [
  "pytest>=9.0.2",
]

[tool.hatch.build.targets.wheel]
packages = [ "src/yosoi" ]

[tool.ruff]
# Assume Python 3.13
target-version = "py313"
line-length = 120
indent-width = 4

format.quote-style = "single"
format.line-ending = "auto"
format.skip-magic-trailing-comma = false

lint.select = [
  "ARG",  # flake8-unused-arguments
  "B",    # flake8-bugbear
  "C901", # mccabe complexity
  "E",    # pycodestyle errors
  "F",    # pyflakes
  "I",    # isort (import sorting)
  "PERF", # performance anti-patterns
  "RET",  # flake8-return
  "SIM",  # flake8-simplify
  "TID",  # flake8-tidy-imports
  "UP",   # pyupgrade
  "W",    # pycodestyle warnings
]

lint.ignore = [
  "ARG001", # unused args are common in dynamic APIs
  "B008",   # allow function calls in defaults when intentional
  "E402",   # module level import not at top of file
  "E501",   # formatter handles line length
  "RET504", # allow implicit return None
  "SIM108", # allow if-else instead of ternary
  "W293",   # blank line contains whitespace
]
lint.mccabe.max-complexity = 13

[tool.mypy]
python_version = "3.13"

warn_unused_configs = true
warn_return_any = true
warn_redundant_casts = true
warn_unused_ignores = true
warn_no_return = true
warn_unreachable = true
strict_equality = true
check_untyped_defs = true
no_implicit_optional = true

# Progressive strictness - enable these when ready
disallow_untyped_defs = false    # TODO: Enable for full type coverage
disallow_any_generics = false    # TODO: Enable for stricter generics
disallow_subclassing_any = false
disallow_untyped_calls = false
disallow_incomplete_defs = false

show_error_codes = true
show_column_numbers = true
pretty = true

ignore_missing_imports = true

[[tool.mypy.overrides]]
module = [
  "scrapegraphai.*",
  "langchain.*",
  "langchain_google_genai.*",
  "langchain_core.*",
  "langchain_community.*",
  "dspy.*",
  "toonify.*",
]
ignore_missing_imports = true

[tool.gitleaks]
# Configuration for Gitleaks moved to pyproject.toml

[[tool.gitleaks.rules]]
id = "generic-api-key"
description = "Generic API Key"
regex = '''(?i)(?:key|api|token|secret|password)[\s]*[=:>]{1}[\s]*['"]?([a-z0-9_\-]{20,})['"]?'''
entropy = 4.5

[[tool.gitleaks.allowlist]]
paths = [
  '''.*\.md$''',
]
regexes = [
  '''llama-3\.3-70b-versatile''', # Model name, not a secret
  '''gemini-2\.0-flash-exp''',    # Model name, not a secret
]

[tool.commitizen]
name = "cz_conventional_commits"
tag_format = "v$version"
version_scheme = "semver"
version_provider = "pep621"      # Reads/updates version in [project] section of pyproject.toml
update_changelog_on_bump = true
major_version_zero = true        # Keeps you in 0.x.x (beta) semantics

types = [
  { value = "feat", name = "feat: A new feature" },
  { value = "fix", name = "fix: A bug fix" },
  { value = "docs", name = "docs: Documentation only changes" },
  { value = "style", name = "style: Formatting (ruff, black, etc)" },
  { value = "refactor", name = "refactor: Code change that neither fixes a bug nor adds a feature" },
  { value = "perf", name = "perf: A code change that improves performance" },
  { value = "test", name = "test: Adding or correcting tests" },
  { value = "build", name = "build: Changes that affect the build system (uv, pyproject.toml)" },
  { value = "ci", name = "ci: CI configuration (GitHub Actions)" },
  { value = "chore", name = "chore: Other changes that don't modify src or test files" },
]
